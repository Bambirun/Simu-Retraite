<!DOCTYPE html>
<html>
<head>
    <title>Simulateur de Retraite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { color: #333; }
        label { font-weight: bold; }
        input[type="date"] { padding: 5px; margin: 10px 0; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
        th { background-color: #f2f2f2; }
        .total { font-weight: bold; }
    </style>
</head>
<body>
    <h2>Simulateur de Retraite</h2>
    <label for="depart">Date de départ :</label>
    <input type="date" id="depart" onchange="calculerPension()">
    <div id="resultat"></div>

    <script>
        // Données des échelons
        const echelons = [
            { date: new Date('2029-08-01'), echelon: 'HEA1', pension: 3304.41 },
            { date: new Date('2030-08-01'), echelon: 'HEA2', pension: 3433.64 },
            { date: new Date('2031-08-01'), echelon: 'HEA3/HEB1', pension: 3607.17 },
            { date: new Date('2032-08-01'), echelon: 'HEB2', pension: 3758.48 },
            { date: new Date('2033-08-01'), echelon: 'HEB3', pension: 3957.91 }
        ];

        // Snbi selon l'année de départ
        const snbiParAnneeDepart = {
            2029: 84.95,
            2030: 89.6,
            2031: 94.39,
            2032: 99.11,
            2033: 103.83
        };

        // ATC dégressif
        const atcParAnnee = [
            2964, 2964, // Années 1-2
            2331, 2331, 2331, 2331, 2331, 2331, // Années 3-8
            1264, 1264, 1264, 1264, 1264 // Années 9-13
        ];

        function calculerPension() {
            let dateDepartInput = document.getElementById('depart').value;
            if (!dateDepartInput) return;

            let dateDepart = new Date(dateDepartInput);
            let anneeDepart = dateDepart.getFullYear();
            // Date de naissance exacte
            let dateNaissance = new Date('1976-02-06');
            let age = (dateDepart - dateNaissance) / (1000 * 60 * 60 * 24 * 365.25);

            // Trouver la pension de base
            let pensionBase = 3304.41; // Par défaut HEA1
            for (let e of echelons) {
                if (dateDepart >= e.date) pensionBase = e.pension;
            }
            // Décote si départ avant avril 2030
            if (dateDepart < new Date('2030-04-01')) pensionBase *= 0.949;

            // Déterminer le Snbi selon l'année de départ
            let snbiMontant = snbiParAnneeDepart[anneeDepart] || 0;

            // Générer tableau pour 20 ans
            let tableau = '<table>';
            tableau += '<tr><th>Année</th><th>Pension Base (€)</th><th>ATC (€)</th><th>RAFP (€)</th><th>Snbi (€)</th><th>Total (€)</th></tr>';

            for (let i = 0; i <= 20; i++) {
                let annee = dateDepart.getFullYear() + i;
                let ageAnnee = age + i;

                // ATC : 0 après 13 ans
                let atc = i < atcParAnnee.length ? atcParAnnee[i] : 0;
                // RAFP : à partir de 62 ans (6 février 2038)
                let rafp = ageAnnee >= 62 ? 63.92 : 0;
                // Snbi : uniquement de 2029 à 2033, selon l'année de départ
                let snbi = (annee >= 2029 && annee <= 2033) ? snbiMontant : 0;
                let total = pensionBase + atc + rafp + snbi;

                tableau += `<tr><td>${annee}</td><td>${pensionBase.toFixed(2)}</td><td>${atc.toFixed(2)}</td><td>${rafp.toFixed(2)}</td><td>${snbi.toFixed(2)}</td><td class="total">${total.toFixed(2)}</td></tr>`;
            }
            tableau += '</table>';
            document.getElementById('resultat').innerHTML = tableau;
        }
    </script>
</body>
</html>
